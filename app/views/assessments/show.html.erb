<% content_for :javascript do %>
  $(function() {
    addMapMarkers(<%= countries_to_point_json(@assessment.countries) %>);
  });
<% end %>
<div class="block-heading">
  <%
    headline_width = 635
    headline_width -= 90 if can? :update, Assessment
    headline_width -= 90 if can? :destroy, Assessment
  %>
  <div class="headline" style='width:<%= headline_width %>px'>
    <h2 class='no-margin'><%= @assessment.title %></h2>
    <% if @assessment.short_title.present? %><h3><%= @assessment.short_title %></h3><% end %>
    <% if current_user && current_user.admin? && @assessment.last_editor.present? %>
      <span id='last-editor'>last edited by <%= link_to @assessment.last_editor, user_path(@assessment.last_editor) %></span>
    <% end %>
  </div>
  <div class="buttons">
    <a href="#" onclick="window.print();return false">Print assessment</a>
    <%= link_to 'Download excel', download_assessment_assessment_path(@assessment, format: 'csv'), class: 'blue' %>
    <% if can? :update, Assessment %>
      <%= link_to 'EDIT', edit_assessment_path(@assessment), class: 'btn btn-primary' %>
    <% end %>
    <% if can? :destroy, Assessment %>
      <%= link_to 'DELETE', @assessment, confirm: 'Are you sure?', method: :delete, class: 'btn btn-danger' %>
    <% end %>
  </div>
</div>

<div class='section'>
  <h2>Geographical coverage</h2>
  <div class="map-holder">
    <div id="map"></div>
    <table class="info">
      <tbody>
        <tr>
          <th>Geographical scale of the assessment</th>
          <td>
            <% @assessment.answers.where(answer_type: 'geo_scale').each do |answer| %>
              <%= answer.text_value %>
            <% end %>
            <%= 'No information added' if @assessment.answers.where(answer_type: 'geo_scale').empty? || @assessment.answers.where(answer_type: 'geo_scale').first.text_value == '' %>
          </td>
        </tr>
        <tr class="mark">
          <th>Countries covered</th>
          <td>
            <%= list_countries_without_multiple(@assessment) %>
            <%= 'No information added' if list_countries_without_multiple(@assessment) == '' %>
          </td>
        </tr>
        <tr class="last-row">
          <th>Any other necessary information or explanation for identifying the location of the assessment, including site or region name	    </th>
          <td>
            <% @assessment.answers.where(answer_type: 'geo_info').each do |answer| %>
              <%= markdown answer.text_value %>
            <% end %>
            <%= 'No information added' if @assessment.answers.where(answer_type: 'geo_info').empty? || @assessment.answers.where(answer_type: 'geo_info').first.text_value == '' %>
          </td>
        </tr>
      </tbody>
    </table>
  </div>
</div>

<div class="section-container">
  <div class='section' id="conceptual_framework">
    <h2>Conceptual framework, methodology and scope</h2>

    <div class='block'>
      <h3>Assessment objectives</h3>

      <% @assessment.answers.where(answer_type: 'objectives').each do |answer| %>
        <%= markdown answer.text_value %>
      <% end %>
      <%= 'No information added' if @assessment.answers.where(answer_type: 'objectives').empty? || @assessment.answers.where(answer_type: 'objectives').first.text_value == '' %>
    </div>

    <div class='block'>
      <h3>Mandate for the assessment</h3>

      <% @assessment.answers.where(answer_type: 'mandate').each do |answer| %>
        <%= markdown answer.text_value %>
      <% end %>
      <%= 'No information added' if @assessment.answers.where(answer_type: 'mandate').empty? || @assessment.answers.where(answer_type: 'mandate').first.text_value == '' %>
    </div>

    <div class='block'>
      <h3>Conceptual framework and/or methodology used for the assessment</h3>

      <% @assessment.answers.where(answer_type: 'conceptual_framework').each do |answer| %>
        <p><%= answer.text_value %></p>
      <% end %>

      <% @assessment.answers.where(answer_type: 'conceptual_framework_other').each do |answer| %>
        <p><%= answer.text_value %></p>
      <% end %>
      <%= 'No information added' if (@assessment.answers.where(answer_type: 'conceptual_framework').empty? || @assessment.answers.where(answer_type: 'conceptual_framework').first.text_value == '') && (@assessment.answers.where(answer_type: 'conceptual_framework_other').empty? || @assessment.answers.where(answer_type: 'conceptual_framework_other').first.text_value == '') %>
    </div>

    <div class='block'>
      <h3>URL or copy of conceptual framework developed or adapted</h3>

      <% @assessment.answers.where(answer_type: 'conceptual_framework_url').each do |answer| %>
        <%= markdown answer.text_value %>
      <% end %>
      <%= 'No information added' if @assessment.answers.where(answer_type: 'conceptual_framework_url').empty? || @assessment.answers.where(answer_type: 'conceptual_framework_url').first.text_value == '' %>
    </div>

    <div class='block'>
      <h3>References</h3>
      <% @assessment.references.where(reference_type: 'conceptual_framework_url').each do |reference| %>
        <p>
          <%= reference.reference_text %><br/>
          <%= link_to reference.file.original_filename, reference.file.url %>
        </p>
      <% end %>
      <%= 'No information added' if @assessment.references.where(reference_type: 'conceptual_framework_url').empty? %>
    </div>

    <div class='block'>
      <h3>System(s) assessed</h3>

      <p>
        <ul>
          <% @assessment.answers.where(answer_type: 'systems_assessed').each do |answer| %>
            <% answer.text_value.split(',').each do |sub_answer| %>
              <li><%= sub_answer %></li>
            <% end %>
          <% end %>

          <% @assessment.answers.where(answer_type: 'systems_assessed_other').each do |answer| %>
            <li><%= answer.text_value %></li>
          <% end %>
        </ul>

        <%= 'No information added' if (@assessment.answers.where(answer_type: 'systems_assessed').empty? || @assessment.answers.where(answer_type: 'systems_assessed').first.text_value == '') && (@assessment.answers.where(answer_type: 'systems_assessed_other').empty? || @assessment.answers.where(answer_type: 'systems_assessed_other').first.text_value == '') %>
      </p>
    </div>

    <div class='block'>
      <h3>Species groups assessed</h3>

      <% @assessment.answers.where(answer_type: 'species_groups_assessed').each do |answer| %>
        <p><%= answer.text_value %></p>
      <% end %>
      <%= 'No information added' if @assessment.answers.where(answer_type: 'species_groups_assessed').empty? %>
    </div>
  </div>
  <div class='section' id="ecosystem_services">
    <h2>Ecosystem services/functions assessed</h2>

    <div class='block'>
      <h3>Provisioning</h3>

      <p>
        <ul>
          <% @assessment.answers.where(answer_type: 'provisioning').each do |answer| %>
            <% answer.text_value.split(',').each do |sub_answer| %>
              <li><%= sub_answer %></li>
            <% end %>
          <% end %>

          <% @assessment.answers.where(answer_type: 'provisioning_other').each do |answer| %>
            <li><%= answer.text_value %></li>
          <% end %>
        </ul>

        <%= 'No information added' if (@assessment.answers.where(answer_type: 'provisioning').empty? || @assessment.answers.where(answer_type: 'provisioning').first.text_value == '') && (@assessment.answers.where(answer_type: 'provisioning_other').empty? || @assessment.answers.where(answer_type: 'provisioning_other').first.text_value == '') %>
      </p>
    </div>

    <div class='block'>
      <h3>Regulating</h3>

      <p>
        <ul>
          <% @assessment.answers.where(answer_type: 'regulating').each do |answer| %>
            <% answer.text_value.split(',').each do |sub_answer| %>
              <li><%= sub_answer %></li>
            <% end%>
          <% end %>

          <% @assessment.answers.where(answer_type: 'regulating_other').each do |answer| %>
            <li><%= answer.text_value %></li>
          <% end %>
        </ul>

        <%= 'No information added' if (@assessment.answers.where(answer_type: 'regulating').empty? || @assessment.answers.where(answer_type: 'regulating').first.text_value == '') && (@assessment.answers.where(answer_type: 'regulating_other').empty? || @assessment.answers.where(answer_type: 'regulating_other').first.text_value == '') %>
      </p>
    </div>

    <div class='block'>
      <h3>Supporting Services/Functions</h3>

      <p>
        <ul>
          <% @assessment.answers.where(answer_type: 'supporting').each do |answer| %>
            <% answer.text_value.split(',').each do |sub_answer| %>
              <li><%= sub_answer %></li>
            <% end%>
          <% end %>

          <% @assessment.answers.where(answer_type: 'supporting_other').each do |answer| %>
            <li><%= answer.text_value %></li>
          <% end %>
        </ul>

        <%= 'No information added' if (@assessment.answers.where(answer_type: 'supporting').empty? || @assessment.answers.where(answer_type: 'supporting').first.text_value == '') && (@assessment.answers.where(answer_type: 'supporting_other').empty? || @assessment.answers.where(answer_type: 'supporting_other').first.text_value == '') %>
      </p>
    </div>

    <div class='block'>
      <h3>Cultural Services</h3>

      <p>
        <ul>
          <% @assessment.answers.where(answer_type: 'cultural_services').each do |answer| %>
            <% answer.text_value.split(',').each do |sub_answer| %>
              <li><%= sub_answer %></li>
            <% end%>
          <% end %>

          <% @assessment.answers.where(answer_type: 'cultural_services_other').each do |answer| %>
            <li><%= answer.text_value %></li>
          <% end %>
        </ul>

        <%= 'No information added' if (@assessment.answers.where(answer_type: 'cultural_services').empty? || @assessment.answers.where(answer_type: 'cultural_services').first.text_value == '') && (@assessment.answers.where(answer_type: 'cultural_services_other').empty? || @assessment.answers.where(answer_type: 'cultural_services_other').first.text_value == '') %>
      </p>
    </div>

    <h2>Scope of assessment includes</h2>

    <div class='block'>
      <h3>Drivers of change in systems and services</h3>

      <% @assessment.answers.where(answer_type: 'scope_drivers_of_change').each do |answer| %>
        <p><%= answer.text_value %></p>
      <% end %>
      <%= 'No information added' if @assessment.answers.where(answer_type: 'scope_drivers_of_change').empty? %>
    </div>

    <div class='block'>
      <h3>Impacts of change in services on human well-being</h3>

      <% @assessment.answers.where(answer_type: 'scope_impacts_of_change').each do |answer| %>
        <p><%= answer.text_value %></p>
      <% end %>
      <%= 'No information added' if @assessment.answers.where(answer_type: 'scope_impacts_of_change').empty? %>
    </div>

    <div class='block'>
      <h3>Options for responding/interventions to the trends observed</h3>

      <% @assessment.answers.where(answer_type: 'scope_options_for_responding').each do |answer| %>
        <p><%= answer.text_value %></p>
      <% end %>
      <%= 'No information added' if @assessment.answers.where(answer_type: 'scope_options_for_responding').empty? %>
    </div>

    <div class='block'>
      <h3>Explicit consideration of the role of biodiversity in the systems and services covered by the assessment</h3>

      <% @assessment.answers.where(answer_type: 'scope_explicit_consideration').each do |answer| %>
        <p><%= answer.text_value %></p>
      <% end %>
      <%= 'No information added' if @assessment.answers.where(answer_type: 'scope_explicit_consideration').empty? %>
    </div>
  </div>
  <div class='section' id="timing">
    <h2>Timing of the assessment</h2>

    <div class='block'>
      <h3>Year assessment started</h3>

      <% @assessment.answers.where(answer_type: 'year_started').each do |answer| %>
        <p><%= answer.text_value %></p>
      <% end %>
      <%= 'No information added' if @assessment.answers.where(answer_type: 'year_started').empty? %>
    </div>

    <div class='block'>
      <h3>Year assessment finished</h3>

      <% @assessment.answers.where(answer_type: 'year_finished').each do |answer| %>
        <p><%= answer.text_value %></p>
      <% end %>
      <%= 'No information added' if @assessment.answers.where(answer_type: 'year_finished').empty? %>
    </div>

    <div class='block'>
      <h3>If ongoing, year assessment is anticipated to finish</h3>

      <% @assessment.answers.where(answer_type: 'anticipated_to_finish').each do |answer| %>
        <p><%= answer.text_value %></p>
      <% end %>
      <%= 'No information added' if @assessment.answers.where(answer_type: 'anticipated_to_finish').empty? %>
    </div>

    <div class='block'>
      <h3>Periodicity of assessment</h3>

      <% @assessment.answers.where(answer_type: 'periodicity').each do |answer| %>
        <p><%= answer.text_value %></p>
      <% end %>
      <%= 'No information added' if @assessment.answers.where(answer_type: 'periodicity').empty? %>
    </div>

    <% if answer_object(@assessment, 'periodicity').text_value == 'Repeated' %>
      <div class='block'>
        <h3>If repeated, how frequently</h3>

        <% @assessment.answers.where(answer_type: 'how_frequently').each do |answer| %>
          <p><%= answer.text_value %></p>
        <% end %>
        <%= 'No information added' if @assessment.answers.where(answer_type: 'how_frequently').empty? %>
      </div>
    <% end %>
  </div>
  <div class='section' id="outputs">
    <h2>Assessment outputs</h2>

    <div class='block'>
      <h3>Website(s)</h3>

      <% @assessment.answers.where(answer_type: 'websites').each do |answer| %>
        <p><%= answer.text_value %></p>
      <% end %>
      <%= 'No information added' if @assessment.answers.where(answer_type: 'websites').empty? %>
    </div>

    <div class='block'>
      <h3>Report(s)</h3>

      <% @assessment.references.where(reference_type: 'reports').each do |reference| %>
        <p>
          <%= reference.reference_text %><br/>
          <%= link_to reference.file.original_filename, reference.file.url %>
        </p>
      <% end %>
      <%= 'No information added' if @assessment.references.where(reference_type: 'reports').empty? %>
    </div>

    <div class='block'>
      <h3>Communication materials (e.g. brochure, presentations, posters, audio-visual media)</h3>

      <% @assessment.references.where(reference_type: 'communication_materials').each do |reference| %>
        <p>
          <%= reference.reference_text %><br/>
          <%= link_to reference.file.original_filename, reference.file.url %>
        </p>
      <% end %>
      <%= 'No information added' if @assessment.references.where(reference_type: 'communication_materials').empty? %>
    </div>
    <div class='block'>
      <h3>Journal publications</h3>

      <% @assessment.references.where(reference_type: 'journal_publications').each do |reference| %>
        <p>
          <%= reference.reference_text %><br/>
          <%= link_to reference.file.original_filename, reference.file.url %>
        </p>
      <% end %>
      <%= 'No information added' if @assessment.references.where(reference_type: 'journal_publications').empty? %>
    </div>
    <div class='block'>
      <h3>Training materials</h3>

      <% @assessment.references.where(reference_type: 'training_materials').each do |reference| %>
        <p>
          <%= reference.reference_text %><br/>
          <%= link_to reference.file.original_filename, reference.file.url %>
        </p>
      <% end %>
      <%= 'No information added' if @assessment.references.where(reference_type: 'training_materials').empty? %>
    </div>
    <div class='block'>
      <h3>Other documents/outputs</h3>

      <% @assessment.references.where(reference_type: 'other_documents').each do |reference| %>
        <p>
          <%= reference.reference_text %><br/>
          <%= link_to reference.file.original_filename, reference.file.url %>
        </p>
      <% end %>
      <%= 'No information added' if @assessment.references.where(reference_type: 'other_documents').empty? %>
    </div>
  </div>
  <div class='section' id="tools_and_processes">
    <h2>Tools and processes</h2>

    <div class='block'>
      <h3>Tools and approaches used in the assessment</h3>

      <p>
        <ul>
          <% @assessment.answers.where(answer_type: 'tools_and_approaches').each do |answer| %>
            <% answer.text_value.split(',').each do |sub_answer| %>
              <li><%= sub_answer %></li>
            <% end%>
          <% end %>

          <% @assessment.answers.where(answer_type: 'tools_and_approaches_other').each do |answer| %>
            <li><%= answer.text_value %></li>
          <% end %>
        </ul>

        <%= 'No information added' if (@assessment.answers.where(answer_type: 'tools_and_approaches').empty? || @assessment.answers.where(answer_type: 'tools_and_approaches').first.text_value == '') && (@assessment.answers.where(answer_type: 'tools_and_approaches_other').empty? || @assessment.answers.where(answer_type: 'tools_and_approaches_other').first.text_value == '') %>
      </p>
      <h3>References</h3>
      <% @assessment.references.where(reference_type: 'tools_and_approaches_other').each do |reference| %>
        <p>
          <%= reference.reference_text %><br/>
          <%= link_to reference.file.original_filename, reference.file.url %>
        </p>
      <% end %>
      <%= 'No information added' if @assessment.references.where(reference_type: 'tools_and_approaches_other').empty? %>
    </div>
    <div class='block'>
      <h3>Process used for stakeholder engagement in the assessment process and which component</h3>

      <% @assessment.answers.where(answer_type: 'process_used_for_stakeholder').each do |answer| %>
        <%= markdown answer.text_value %>
      <% end %>
      <%= 'No information added' if @assessment.answers.where(answer_type: 'process_used_for_stakeholder').empty? %>
    </div>
    <div class='block'>
      <h3>Key stakeholder groups engaged</h3>

      <% @assessment.answers.where(answer_type: 'key_stakeholder').each do |answer| %>
        <%= markdown answer.text_value %>
      <% end %>
      <%= 'No information added' if @assessment.answers.where(answer_type: 'key_stakeholder').empty? %>
    </div>
    <div class='block'>
      <h3>The number of people directly involved in the assessment process</h3>

      <% @assessment.answers.where(answer_type: 'number_of_people').each do |answer| %>
        <p><%= answer.text_value %></p>
      <% end %>
      <%= 'No information added' if @assessment.answers.where(answer_type: 'number_of_people').empty? %>
    </div>
    <div class='block'>
      <h3>Incorporation of scientific and other types of knowledge</h3>

      <p>
        <ul>
          <% @assessment.answers.where(answer_type: 'incorporation_of_knowledge').each do |answer| %>
            <% answer.text_value.split(',').each do |sub_answer|%>
              <li><%= sub_answer %></li>
            <% end %>
          <% end %>
        </ul>
        <%= 'No information added' if @assessment.answers.where(answer_type: 'incorporation_of_knowledge').empty? || @assessment.answers.where(answer_type: 'incorporation_of_knowledge').first.text_value == '' %>
      </p>
    </div>
    <div class='block'>
      <h3>Supporting documentation for specific approaches, methodology or criteria developed and/or used to integrate knowledge systems into the assessment</h3>

      <% @assessment.references.where(reference_type: 'supporting_documentation').each do |reference| %>
        <p>
          <%= reference.reference_text %><br/>
          <%= link_to reference.file.original_filename, reference.file.url %>
        </p>
      <% end %>
      <%= 'No information added' if @assessment.references.where(reference_type: 'supporting_documentation').empty? %>
    </div>
    <div class='block'>
      <h3>Assessment reports peer reviewed</h3>

      <% @assessment.answers.where(answer_type: 'reports_peer').each do |answer| %>
        <p><%= answer.text_value %></p>
      <% end %>
      <%= 'No information added' if @assessment.answers.where(answer_type: 'reports_peer').empty? %>
    </div>
  </div>
  <div class='section' id="data">
    <h2>Data</h2>

    <div class='block'>
      <h3>Accessibility of data used in assessment</h3>

      <% @assessment.answers.where(answer_type: 'accessibility_of_data').each do |answer| %>
        <%= markdown answer.text_value %>
      <% end %>
      <%= 'No information added' if @assessment.answers.where(answer_type: 'accessibility_of_data').empty? %>
    </div>
  </div>
  <div class='section' id="policy_impact">
    <h2>Policy Impact</h2>

    <div class='block'>
      <h3>Impacts the assessment has had on policy and/or decision making, as evidenced through policy references and actions</h3>

      <% @assessment.references.where(reference_type: 'impacts').each do |reference| %>
        <p>
          <%= reference.reference_text %><br/>
          <%= link_to reference.file.original_filename, reference.file.url %>
        </p>
      <% end %>
      <%= 'No information added' if @assessment.references.where(reference_type: 'impacts').empty? %>
    </div>
    <div class='block'>
      <h3>Independent or other review on policy impact of the assessment</h3>

      <% @assessment.answers.where(answer_type: 'review_on_policy').each do |answer| %>
        <p><%= answer.text_value %></p>
      <% end %>
      <% @assessment.references.where(reference_type: 'review_on_policy').each do |reference| %>
        <p>
          <%= reference.reference_text %><br/>
          <%= link_to reference.file.original_filename, reference.file.url %>
        </p>
      <% end %>
      <%= 'No information added' if @assessment.answers.where(answer_type: 'review_on_policy').empty? && @assessment.references.where(reference_type: 'review_on_policy').empty? %>
    </div>
    <div class='block'>
      <h3>Lessons learnt for future assessments from these reviews</h3>

      <% @assessment.answers.where(answer_type: 'lessons_learnt').each do |answer| %>
        <%= markdown answer.text_value %>
      <% end %>
      <%= 'No information added' if @assessment.answers.where(answer_type: 'lessons_learnt').empty? %>
    </div>
  </div>
  <div class='section' id="capacity_building">
    <h2>Capacity-building</h2>

    <div class='block'>
      <h3>Capacity building needs idenfified during the assessment</h3>

      <% @assessment.answers.where(answer_type: 'capacity_building_needs').each do |answer| %>
        <%= markdown answer.text_value %>
      <% end %>
      <%= 'No information added' if @assessment.answers.where(answer_type: 'capacity_building_needs').empty? %>
    </div>
    <div class='block'>
      <h3>Actions taken by the assessment to build capacity</h3>

      <% @assessment.answers.where(answer_type: 'actions_taken_build_capacity').each do |answer| %>
        <p><%= answer.text_value %></p>
      <% end %>
      <%= 'No information added' if @assessment.answers.where(answer_type: 'actions_taken_build_capacity').empty? %>
    </div>
    <div class='block'>
      <h3>How have gaps in capacity been communicated to the different stakeholders</h3>

      <% @assessment.answers.where(answer_type: 'gaps_in_capacity').each do |answer| %>
        <%= markdown answer.text_value %>
      <% end %>
      <%= 'No information added' if @assessment.answers.where(answer_type: 'gaps_in_capacity').empty? %>
    </div>
    <div class='section' id="knowledge_generation">
      <h2>Knowledge generation</h2>
    </div>
    <div class='block'>
      <h3>Gaps in knowledge identified from the assessment</h3>

      <% @assessment.answers.where(answer_type: 'gaps_in_knowledge').each do |answer| %>
        <%= markdown answer.text_value %>
      <% end %>
      <%= 'No information added' if @assessment.answers.where(answer_type: 'gaps_in_knowledge').empty? %>
    </div>
    <div class='block'>
      <h3>How gaps in knowledge have been communicated to the different stakeholders</h3>

      <% @assessment.answers.where(answer_type: 'gaps_in_knowledge_communicated').each do |answer| %>
        <%= markdown answer.text_value %>
      <% end %>
      <% @assessment.references.where(reference_type: 'gaps_in_knowledge_communicated').each do |reference| %>
        <p>
          <%= reference.reference_text %><br/>
          <%= link_to reference.file.original_filename, reference.file.url %>
        </p>
      <% end %>
      <%= 'No information added' if @assessment.answers.where(answer_type: 'gaps_in_knowledge_communicated').empty? && @assessment.references.where(reference_type: 'gaps_in_knowledge_communicated').empty? %>
    </div>
  </div>
  <div class='section last' id="additional_information">
    <h2>Additional information</h2>

    <div class='block'>
      <h3>Additional relevant information</h3>

      <% @assessment.answers.where(answer_type: 'additional_information').each do |answer| %>
        <p><%= answer.text_value %></p>
      <% end %>
      <%= 'No information added' if @assessment.answers.where(answer_type: 'additional_information').empty? || @assessment.answers.where(answer_type: 'additional_information').first.text_value == '' %>
    </div>
  </div>
</div>
